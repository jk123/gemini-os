#!/bin/bash
# Gemini OS - Ultimate Chat Command Interface (Heredoc)

# Jos parametria ei ole, luetaan stdinist채
if [ -z "$1" ]; then
    CODE=$(cat)
else
    CODE=$1
fi

KEY_ID=$(gpg --list-keys --with-colons | grep "^pub" | cut -d: -f5 | head -n 1)
PAYLOAD=$(printf -- "-- [run]remote_cmd.py --\n%s\n" "$CODE")

# Allekirjoitetaan ja l채hetet채채n API:lle
echo "$PAYLOAD" | gpg --clearsign --local-user "$KEY_ID" -a | \
curl -s -X POST http://localhost:5000/deploy \
    -H "Content-Type: text/plain" \
    --data-binary @- | python3 -m json.tool
