#!/bin/bash
# Gemini OS - TX Engine (v9: Strict Section Split)

python3 -c "
import sys, os, subprocess, stat, re

# K채ytet채채n regexi채, joka etsii erottimen VAIN rivin alusta
raw_input = sys.stdin.read()
sections = re.split(r'\n-- |^-- ', raw_input)

for section in sections:
    if not section.strip(): continue
    if ' --' in section:
        header, content = section.split(' --', 1)
        header = header.strip()
        tags = re.findall(r'\[(.*?)\]', header)
        filename = re.sub(r'\[.*?\]', '', header).strip()
        
        if not filename and tags:
            filename = f'[{tags[-1]}]' if len(tags) == 1 else header
            tags = tags[:-1]

        if not filename: continue
        
        full_path = os.path.abspath(filename)
        os.makedirs(os.path.dirname(full_path), exist_ok=True)
        with open(full_path, 'w') as f:
            f.write(content.lstrip())
        
        if 'run' in tags:
            os.chmod(full_path, 0o755)
            # Suoritetaan ja napataan tuloste puhtaasti
            subprocess.run([sys.executable, full_path] if filename.endswith('.py') else [full_path])
"
