#!/bin/bash
# Gemini OS - Autonomous Self-Healer

PROMPT=$1
SYSTEM_MSG="Luo .txtar paketti. K√§yt√§ [run], [service] tai [cron] tageja."

echo "ü§ñ Vaihe 1: Generoidaan ja asennetaan..."
RESPONSE=$(ai "$SYSTEM_MSG Teht√§v√§: $PROMPT")
echo "$RESPONSE" | tx > /tmp/tx_result.log 2>&1
cat /tmp/tx_result.log

# Tarkistetaan ep√§onnistuiko ajo
if grep -q "‚ùå Error" /tmp/tx_result.log; then
    ERROR_MSG=$(cat /tmp/tx_result.log)
    echo "‚ö†Ô∏è Virhe havaittu! Yritet√§√§n autonomista korjausta..."
    
    # Pyydet√§√§n AI:lta korjattu versio virheen perusteella
    FIX_PROMPT="Edellinen koodi ep√§onnistui t√§ll√§ virheell√§: $ERROR_MSG. Luo korjattu .txtar paketti."
    ai "$FIX_PROMPT" | tx
    echo "‚úÖ Korjausyritys suoritettu."
else
    echo "‚úÖ Teht√§v√§ suoritettu onnistuneesti."
fi
